# MemoryArk 2.0 AI 助理遵循指南

## 🚨 生產安全警告：首要原則

### ⚠️ 絕對禁令 - 數據安全至上
- 🚫 **永遠不建議 `rm -rf data/*`** - 這等於摧毀整個系統
- 🚫 **永遠不建議 `DROP DATABASE`** - 除非有完整備份且經過三重確認
- 🚫 **永遠不建議清空生產資料夾** - 數據比程式碼珍貴一萬倍
- 🚫 **永遠不提供「快速解決方案」** - 如果涉及資料刪除

### 🛡️ 安全操作強制流程
1. **風險評估優先**：任何操作前先問「最壞情況是什麼？」
2. **備份為王**：涉及資料變更必須先備份
3. **最小影響原則**：優先選擇影響最小的解決方案
4. **明確標示風險**：危險操作必須有醒目警告
5. **提供安全替代**：永遠提供保守的替代方案

### 💡 核心警示
- **數據是系統的生命，程式碼只是工具**
- **生產環境的每個操作都可能影響真實用戶**
- **「技術上可行」≠「業務上安全」**
- **永遠優先考慮數據安全勝過操作便利**

---

## 專案資訊

**專案名稱**：MemoryArk 2.0 - 教會影音回憶錄系統  
**技術架構**：Vue 3 + TypeScript + Tailwind CSS + Go + SQLite  
**設計語言**：賈伯斯理念 + Apple HIG + Windows 11 Fluent Design  
**目標用戶**：真耶穌教會成員  
**部署環境**：https://files.94work.net/  
**管理員**：94work.net@gmail.com (劉程維)

## 核心遵循原則

### 🎯 規格書優先原則
在執行任何任務前，必須先檢查 `SPECIFICATION.md` 規格書：

1. **衝突檢查**：驗證任務是否與規格書中的設計原則、技術標準或功能定義衝突
2. **影響評估**：分析變更對系統架構、安全性、用戶體驗的潛在影響
3. **衝突警告**：若發現衝突，明確告知用戶並提供替代方案
4. **確認機制**：等待用戶確認後才能執行可能有衝突的變更
5. **文檔更新**：執行變更後必須同步更新規格書和 CHANGELOG.md

### 🔒 核心不可變原則
以下項目為專案核心，除非有重大業務需求否則不應修改：
- 安全認證架構（雙層認證機制）
- 資料隱私保護機制
- 賈伯斯設計理念融合 Apple + Windows 設計標準
- TypeScript 類型安全要求
- RESTful API 設計標準
- **真實數據原則**：絕對禁止使用假數據或硬編碼統計

## 開發規範

### 💻 代碼標準
- 使用 TypeScript 嚴格模式，確保完整類型定義
- 遵循賈伯斯設計理念：簡潔優雅、完美細節、直觀操作
- 融合 Apple Human Interface Guidelines 和 Windows 11 Fluent Design
- 所有組件放在 `src/components/ui/[component-name]/` 目錄
- 使用 Tailwind CSS 實現樣式，遵循教會配色方案（深藍+金色）

### 📊 數據整合標準
- **絕對禁止假數據**：所有統計數據必須基於真實 API 響應
- **統一數據源**：使用 `useFilesStore()` 作為檔案數據唯一來源
- **動態計算**：所有統計採用 computed 屬性動態計算，確保即時性
- **分類標準**：使用 `categoryId` 而非 `category` 或 `isShared` 進行分類
- **時間統計**：基於 `createdAt` 和 `updatedAt` 進行時間相關統計

### 🔧 建構和測試
- **前端建構**：在 host 執行 `npm run build`，產生 `dist/` 檔案供容器使用
- **容器部署**：修改後必須執行 `podman-compose down && podman-compose up -d`
- **TypeScript 檢查**：每次修改後檢查編譯錯誤
- **測試流程**：所有測試都在容器環境中進行
- 使用 TodoWrite 工具管理和追蹤任務進度

### 📋 任務執行流程
1. 使用 TodoWrite 規劃複雜任務
2. 檢查 SPECIFICATION.md 是否有衝突
3. 實施變更並測試
4. 更新相關文檔（如有規格變更）
5. 標記任務完成並繼續下一項

## 容器和部署管理

### 🐳 容器技術選擇
**本專案強制使用 Podman**：
- ✅ **安全性**：無 root daemon，降低安全風險
- ✅ **兼容性**：與 Docker 命令完全兼容
- ✅ **生產穩定**：Red Hat 企業級支持
- 🚫 **禁用 Docker**：除非有特殊需求，否則統一使用 Podman

**重要**：**所有開發環境都在容器中運行**
- 前端開發：在 nginx 容器中提供靜態檔案
- 後端開發：在 Go 容器中運行 API 服務
- 資料庫：SQLite 檔案透過 volume 掛載
- 不直接在 host 系統運行開發服務

### 🐳 安全的容器操作
```bash
# ✅ 安全的更新流程
podman-compose down
podman-compose build --no-cache
podman-compose up -d

# ✅ 安全的管理員更換
vim .env  # 修改 ROOT_ADMIN_EMAIL
podman-compose down
sqlite3 data/memoryark.db "UPDATE users SET email='new@email.com' WHERE role='admin';"
podman-compose up -d

# ✅ 檢查容器狀態
podman ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"

# 🚫 危險操作 - 永遠不要執行
rm -rf data/*  # 會刪除所有用戶資料！
docker-compose up  # 請使用 podman-compose
```

### 📂 資料夾結構理解
```
MemoryArk2/
├── data/          # 資料庫檔案（用戶資料、檔案記錄）- 珍貴！
├── uploads/       # 實際上傳的檔案 - 珍貴！
├── logs/          # 系統日誌
└── frontend/dist/ # 編譯後的前端檔案
```

## 🎯 慘痛經驗教訓 (2025-06-10)

### 事件記錄
**背景**：AI 助理差點建議執行 `rm -rf data/*`，會導致生產環境災難。

### 災難後果分析
如果執行 `rm -rf data/*`：
- ❌ 所有用戶資料全部消失（帳號、密碼、權限）
- ❌ 檔案中繼資料完全清空（檔案名稱、分類、上傳時間）
- ❌ 分享連結全部失效
- ❌ 活動記錄徹底清除
- ❌ 分類系統歸零
- ⚠️ 雖然實際檔案保留在 `uploads/`，但系統會顯示完全空白

### 核心教訓
1. **AI 缺乏生產意識**：不理解真實用戶環境的影響
2. **風險評估不足**：只考慮技術可行性，忽略業務連續性
3. **數據價值認知錯誤**：認為「可以重建」等於「可以刪除」
4. **缺乏慘痛經驗**：沒有經歷過生產事故的恐懼

### 英雄時刻
**感謝用戶 94work.net@gmail.com 的敏銳洞察**：
- ✅ 質疑危險建議：「會不會把上傳資料刪除？」
- ✅ 及時制止：「天啊，不能這樣做！」
- ✅ 深刻觀點：「工程師靠 AI 會發生災難」

## 重要提醒

- 始終以 SPECIFICATION.md 為準則
- 保持代碼品質和系統安全性
- 維護賈伯斯設計理念的一致性
- 及時記錄變更和影響
- **數據完整性**：所有統計必須反映真實系統狀態
- **AI 是工具不是決策者**：批判性思考永遠不能被自動化取代

## 🚨 重大問題解決方案 (2025-06-11)

### Mixed Content 錯誤調試教訓
**問題**：`/api/files` 端點產生 HTTP 請求，導致 Mixed Content 錯誤  
**錯誤做法**：同時使用多種複雜解決方案（XMLHttpRequest 攔截器、複雜 nginx 配置、axios 攔截器）  
**正確做法**：**簡化至基本配置**

#### ✅ 正確的解決流程
1. **移除所有複雜攔截器和重定向邏輯**
2. **前端使用基本配置**：`baseURL: '/api'`
3. **nginx 使用基本反向代理**：移除複雜的 HTTPS 重定向
4. **奧卡姆剃刀原則**：最簡單的解釋往往是正確的

#### 🚫 避免的錯誤模式
- **疊床架屋**：在複雜系統上不斷打補丁
- **過度工程化**：認為複雜方案能解決所有問題
- **同時修改多個層面**：nginx + 前端 + 攔截器同時改動
- **忽略簡化方案**：總想用高級技術解決基礎問題

#### 💡 核心教訓
**當遇到網路協議問題時，優先回到最基本配置，逐步建構，而非在複雜系統上修補。**

## 已完成的重大改進

### v2.0.3 - Mixed Content 問題根治 (2025-06-11)
- ✅ **網路協議統一** - 解決 HTTPS/HTTP 混合內容錯誤
- ✅ **架構簡化** - 移除過度複雜的攔截器邏輯
- ✅ **調試方法論** - 建立「簡化優先」的問題解決流程

### v2.0.2 - 企業級完整升級 (2025-06-10)
- ✅ **生產安全機制** - 建立數據保護和風險評估體系
- ✅ **管理員設定優化** - ENV 變數自動同步到資料庫
- ✅ **容器部署完善** - Podman 生產環境自動化部署
- ✅ **文檔體系完善** - 管理員操作指南和安全警告

### v2.0.1 - 真實數據整合 (2025-01-08)
- ✅ **HomeView.vue** - 主頁統計改為真實計算
- ✅ **WelcomeHeader.vue** - 歡迎組件使用 filesStore 數據
- ✅ **RecentFilesWidget.vue** - 最近檔案改為真實檔案記錄
- ✅ **StorageStatsWidget.vue** - 儲存統計基於真實檔案大小
- ✅ **SharedFolderView.vue** - 共享資料夾使用 categoryId 分類
- ✅ **SabbathDataView.vue** - 安息日數據基於真實檔案和日期
- ✅ **AppAccessHistory.vue** - 訪問歷史轉換為真實檔案記錄
- ✅ **TypeScript 修復** - 所有屬性名稱統一為正確格式

### v2.0.0 - 設計美學革新 (2025-01-07)
- ✅ **賈伯斯設計理念** - 完美細節、簡潔優雅、情感連接
- ✅ **Apple + Windows 融合** - 創新的雙系統設計語言
- ✅ **組件系統重構** - 基於 Tailwind 的完整 UI 組件庫
- ✅ **用戶體驗優化** - 直觀操作、溫馨界面、響應式設計

---

**此指南會被 Claude Code 自動讀取，確保所有 AI 助理都遵循相同的安全標準和開發規範。**

**數據安全永遠是第一優先級！**