# 🏗️ 技術架構

> **深度技術文檔** - 系統架構、設計原理、實現細節

---

## 📐 架構文檔

### 🔄 [串流匯出原理](STREAMING_EXPORT_EXPLAINED.md) ✅ 已驗證
深入了解 MemoryArk 的串流匯出技術：
- 🚀 串流 ZIP 生成原理
- ⚡ 記憶體優化策略
- 🔧 實現細節與代碼示例
- 📊 效能指標

### 📁 [檔案管理架構](FILE_MANAGEMENT_ARCHITECTURE.md) ⚠️ 待檢驗
完整的檔案系統設計：
- 🗂️ 虛擬路徑系統
- 🔗 檔案關聯管理
- 🏷️ 分類標籤系統
- 📝 元數據處理

### 🛡️ [安全分析報告](SECURITY_ANALYSIS.md) ✅ 已驗證
軍用級安全架構深度分析：
- 🔐 256-bit JWT 加密強度
- 🎯 安全測試結果 (97.4% 通過率)
- 🏆 企業級防護機制
- 📊 真實攻擊防護驗證

### 🎯 [完整解決方案](FINAL_FILE_MANAGEMENT_SOLUTION.md) ⚠️ 待檢驗
檔案管理系統的最終設計方案：
- 🏆 架構決策記錄
- 🔄 演進歷程
- ⚖️ 權衡取捨
- 🚀 未來規劃

---

## 🧠 核心技術

### 檔案去重機制
```
SHA256 雜湊 → 重複檢測 → 智能儲存
├── 雜湊計算：crypto/sha256
├── 檔案檢索：GORM 查詢優化
└── 儲存策略：UUID + 雜湊前綴目錄
```

### 串流匯出技術
```
虛擬路徑 → 動態 ZIP → 串流響應
├── 路徑重建：遞歸檔案樹遍歷
├── ZIP 生成：archive/zip 串流模式
└── HTTP 響應：chunked transfer encoding
```

### 虛擬資料夾系統
```
資料庫記錄 → 虛擬路徑 → 檔案樹
├── 資料模型：parent_id 樹狀結構
├── 路徑計算：遞歸路徑建構
└── 檔案服務：實體檔案與虛擬路徑分離
```

---

## 🗄️ 資料庫設計

### 核心表結構

```sql
-- 檔案表（支援虛擬資料夾）
files:
├── id (PRIMARY KEY)
├── name (顯示名稱)
├── file_path (實體路徑，資料夾為空)
├── virtual_path (虛擬路徑)
├── sha256_hash (去重雜湊)
├── parent_id (樹狀結構)
├── is_directory (資料夾標記)
└── is_deleted (軟刪除)
```

### 索引策略
- `idx_sha256_hash`: 去重查詢優化
- `idx_parent_id`: 樹狀查詢優化  
- `idx_virtual_path`: 路徑查詢優化
- `idx_is_deleted`: 垃圾桶查詢優化

---

## 🔧 技術選型

### 後端技術棧
- **框架**: Gin (Go) - 高效能 HTTP 路由
- **資料庫**: SQLite + GORM - 輕量級關聯映射
- **檔案處理**: Go 標準庫 - 串流處理
- **認證**: Cloudflare Access - 企業級安全

### 前端技術棧  
- **框架**: Vue 3 + TypeScript - 現代響應式
- **狀態管理**: Pinia - 輕量級狀態庫
- **UI 組件**: Element Plus - 企業級組件
- **建構工具**: Vite - 快速開發建構

### 部署技術
- **容器化**: Docker/Podman - 一致性部署
- **代理**: Nginx - 高效能反向代理
- **編排**: Docker Compose - 簡化部署

---

## 📊 效能指標

### 檔案去重效能
- **查詢速度**: ~1.05μs (SHA256 雜湊查詢)
- **空間節省**: 30-50% (取決於檔案重複率)
- **記憶體使用**: 256B/操作 (平均)

### 串流匯出效能
- **記憶體佔用**: 恆定 ~10MB (不隨檔案大小增長)
- **併發支援**: 最多 5 個同時匯出作業
- **壓縮率**: 平均 60-80% (取決於檔案類型)

---

## 🔄 演進歷程

### v1.0 → v2.0 主要改進
- ❌ 實體資料夾 → ✅ 虛擬路徑系統
- ❌ 檔案複製 → ✅ SHA256 去重機制  
- ❌ 記憶體匯出 → ✅ 串流匯出技術
- ❌ 硬刪除 → ✅ 軟刪除 + 垃圾桶

---

**學習路徑**: [開發指南](../03-developer/README.md) → [測試文檔](../03-developer/testing/) → **架構文檔** → [運維指南](../05-operations/README.md)