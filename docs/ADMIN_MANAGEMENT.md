# MemoryArk 2.0 ç®¡ç†å“¡è¨­å®šæŒ‡å—

## æ¦‚è¿°

æœ¬æ–‡æª”èªªæ˜å¦‚ä½•æ­£ç¢ºè¨­å®šå’Œæ›´æ› MemoryArk 2.0 ç³»çµ±çš„ç®¡ç†å“¡å¸³è™Ÿï¼Œä»¥åŠç’°å¢ƒè®Šæ•¸èˆ‡è³‡æ–™åº«åŒæ­¥çš„æ©Ÿåˆ¶ã€‚

## ğŸ”§ ç³»çµ±æ¶æ§‹èªªæ˜

### ENV è®Šæ•¸ vs è³‡æ–™åº«çš„é—œä¿‚

MemoryArk 2.0 çš„ç®¡ç†å“¡è¨­å®šæ¡ç”¨**é›™å±¤æ©Ÿåˆ¶**ï¼š

#### 1. **ç’°å¢ƒè®Šæ•¸é…ç½®** (`.env` æª”æ¡ˆ)
```bash
# å®šç¾©ã€Œç³»çµ±è¦å‰‡ã€
ROOT_ADMIN_EMAIL=94work.net@gmail.com
ROOT_ADMIN_NAME=åŠ‰ç¨‹ç¶­
DEV_AUTO_LOGIN_EMAIL=94work.net@gmail.com
```

**ä½œç”¨**ï¼š
- å‘Šè¨´ç³»çµ±ã€Œèª°æ˜¯æ ¹ç®¡ç†å“¡ã€
- é–‹ç™¼æ¨¡å¼è‡ªå‹•ç™»å…¥çš„å¸³è™Ÿ
- åˆå§‹åŒ–æ™‚å»ºç«‹ç®¡ç†å“¡çš„ä¾æ“š

#### 2. **è³‡æ–™åº«è¨˜éŒ„** (`users` è¡¨)
```sql
-- å¯¦éš›çš„ç”¨æˆ¶è³‡æ–™
INSERT INTO users (email, name, role, status) 
VALUES ('94work.net@gmail.com', 'åŠ‰ç¨‹ç¶­', 'admin', 'approved');
```

**ä½œç”¨**ï¼š
- å„²å­˜å®Œæ•´çš„ç”¨æˆ¶å€‹äººè³‡æ–™
- ç³»çµ±å¯¦éš›æŸ¥è©¢å’Œé©—è­‰çš„ä¾†æº
- åŒ…å«æ¬Šé™ã€ç‹€æ…‹ã€å»ºç«‹æ™‚é–“ç­‰è©³ç´°è³‡è¨Š

### ç‚ºä»€éº¼éœ€è¦å…©å€‹éƒ½è¨­å®šï¼Ÿ

**é¡æ¯”èªªæ˜**ï¼š
- **ENV** = é–€ç¦å¡è¦å‰‡è¨­å®šï¼šã€Œé€™å¼µå¡è™Ÿå¯ä»¥é€²å…¥è¾¦å…¬å®¤ã€
- **è³‡æ–™åº«** = äººäº‹è³‡æ–™åº«ï¼šã€Œé€™å€‹äººç¢ºå¯¦å­˜åœ¨ä¸”æ“æœ‰é€™å¼µå¡ã€

å¦‚æœåªæœ‰ ENV æ²’æœ‰è³‡æ–™åº«ï¼šç³»çµ±çŸ¥é“è¦æ‰¾æŸå€‹ç®¡ç†å“¡ï¼Œä½†æ‰¾ä¸åˆ°é€™å€‹äºº
å¦‚æœåªæœ‰è³‡æ–™åº«æ²’æœ‰ ENVï¼šç³»çµ±ä¸çŸ¥é“èª°æ˜¯æ ¹ç®¡ç†å“¡ï¼Œé–‹ç™¼æ¨¡å¼ç„¡æ³•è‡ªå‹•ç™»å…¥

## ğŸ“‹ ç®¡ç†å“¡è¨­å®šæµç¨‹

### ğŸ†• åˆå§‹è¨­å®šï¼ˆå…¨æ–°å®‰è£ï¼‰

1. **ä¿®æ”¹ç’°å¢ƒè®Šæ•¸**
```bash
vim .env
```

```bash
# è¨­å®šä½ çš„ç®¡ç†å“¡è³‡è¨Š
ROOT_ADMIN_EMAIL=your-email@domain.com
ROOT_ADMIN_NAME=ä½ çš„å§“å

# é–‹ç™¼æ¨¡å¼è¨­å®šï¼ˆå¯é¸ï¼‰
DEV_AUTO_LOGIN_EMAIL=your-email@domain.com
DEV_BYPASS_AUTH=true
```

2. **å•Ÿå‹•ç³»çµ±**
```bash
podman-compose up -d
```

ç³»çµ±æœƒè‡ªå‹•ï¼š
- å¾ ENV è®Šæ•¸è®€å–ç®¡ç†å“¡è³‡è¨Š
- åœ¨è³‡æ–™åº«ä¸­å»ºç«‹å°æ‡‰çš„ç®¡ç†å“¡å¸³è™Ÿ
- è¨­å®šå®Œæ•´çš„æ¬Šé™å’Œç‹€æ…‹

### ğŸ”„ æ›´æ›ç®¡ç†å“¡ï¼ˆç¾æœ‰ç³»çµ±ï¼‰

#### æ–¹æ³•ä¸€ï¼šæ‰‹å‹•æ›´æ–°è³‡æ–™åº«ï¼ˆæ¨è–¦ï¼Œå®‰å…¨ï¼‰

```bash
# 1. å‚™ä»½è³‡æ–™åº«ï¼ˆå®‰å…¨èµ·è¦‹ï¼‰
cp data/memoryark.db data/memoryark.db.backup

# 2. ä¿®æ”¹ç’°å¢ƒè®Šæ•¸
vim .env
# æ›´æ–° ROOT_ADMIN_EMAIL å’Œ ROOT_ADMIN_NAME

# 3. åœæ­¢ç³»çµ±
podman-compose down

# 4. ç›´æ¥æ›´æ–°è³‡æ–™åº«ä¸­çš„ç®¡ç†å“¡è³‡è¨Š
sqlite3 data/memoryark.db "UPDATE users SET email='new-email@domain.com', name='æ–°å§“å' WHERE role='admin' AND id=1;"

# 5. é‡æ–°å•Ÿå‹•
podman-compose up -d
```

**å„ªé»**ï¼š
- âœ… ä¿ç•™æ‰€æœ‰è³‡æ–™ï¼ˆæª”æ¡ˆã€ç”¨æˆ¶ã€ä¸­ç¹¼è³‡æ–™ï¼‰
- âœ… åªæ›´æ–°ç®¡ç†å“¡è³‡è¨Š
- âœ… ä¸æœƒå½±éŸ¿å…¶ä»–ç”¨æˆ¶

#### æ–¹æ³•äºŒï¼šå®Œå…¨é‡ç½®ï¼ˆâš ï¸ å±éšªï¼šæœƒæ¸…ç©ºæ‰€æœ‰è³‡æ–™ï¼‰

ğŸš¨ **è­¦å‘Š**ï¼šæ­¤æ–¹æ³•æœƒåˆªé™¤æ‰€æœ‰ç”¨æˆ¶è³‡æ–™ã€æª”æ¡ˆè¨˜éŒ„ï¼Œä½†ä¿ç•™å¯¦éš›æª”æ¡ˆ

```bash
# 1. å®Œæ•´å‚™ä»½ï¼ˆå¿…é ˆï¼‰
mkdir -p backup/$(date +%Y%m%d_%H%M%S)
cp -r data/ backup/$(date +%Y%m%d_%H%M%S)/
cp -r uploads/ backup/$(date +%Y%m%d_%H%M%S)/

# 2. åœæ­¢ç³»çµ±
podman-compose down

# 3. ä¿®æ”¹ç’°å¢ƒè®Šæ•¸
vim .env

# 4. æ¸…é™¤è³‡æ–™åº«ï¼ˆä¿ç•™æª”æ¡ˆï¼‰
rm -rf data/*

# 5. é‡æ–°å•Ÿå‹•
podman-compose up -d
```

**å¾Œæœ**ï¼š
- âŒ æ‰€æœ‰ç”¨æˆ¶éœ€è¦é‡æ–°è¨»å†Š
- âŒ æª”æ¡ˆè¨˜éŒ„æ¶ˆå¤±ï¼ˆä½†æª”æ¡ˆå¯¦é«”å­˜åœ¨ï¼‰
- âŒ åˆ†äº«é€£çµå¤±æ•ˆ
- âŒ æ­·å²è¨˜éŒ„å…¨éƒ¨æ¶ˆå¤±

```bash
# 1. ä¿®æ”¹ç’°å¢ƒè®Šæ•¸
vim .env

# 2. åœæ­¢ç³»çµ±
podman-compose down

# 3. æ‰‹å‹•æ›´æ–°è³‡æ–™åº«
sqlite3 data/memoryark.db "UPDATE users SET email='new-email@domain.com', name='æ–°å§“å' WHERE id=1;"

# 4. é‡æ–°å•Ÿå‹•
podman-compose up -d
```

## ğŸ”§ å®¹å™¨æ›´æ–°æµç¨‹

### ç¨‹å¼ç¢¼æ›´æ–°ä½†ä¸æ›´æ›ç®¡ç†å“¡

```bash
# æ¨™æº–æ›´æ–°æµç¨‹
podman-compose down
podman-compose build --no-cache
podman-compose up -d
```

### ç¨‹å¼ç¢¼æ›´æ–°ä¸”æ›´æ›ç®¡ç†å“¡

```bash
# 1. åœæ­¢ç³»çµ±
podman-compose down

# 2. ä¿®æ”¹ .env æª”æ¡ˆ
vim .env

# 3. æ¸…é™¤èˆŠæ˜ åƒå’Œè³‡æ–™åº«
podman rmi localhost/memoryark2_backend:latest 2>/dev/null || true
rm -rf data/*

# 4. é‡å»ºä¸¦å•Ÿå‹•
podman build --no-cache -t memoryark2_backend:latest .
podman-compose up -d
```

## ğŸ› å¸¸è¦‹å•é¡Œæ’é™¤

### Q1: ä¿®æ”¹äº† .env ä½†ç®¡ç†å“¡æ²’æœ‰æ›´æ–°ï¼Ÿ

**åŸå› **ï¼šè³‡æ–™åº«ä¸­å·²å­˜åœ¨ç®¡ç†å“¡ï¼Œç³»çµ±è·³éå»ºç«‹

**è§£æ±º**ï¼š
```bash
podman-compose down
rm -rf data/*  # æ¸…é™¤è³‡æ–™åº«
podman-compose up -d
```

### Q2: é–‹ç™¼æ¨¡å¼ç„¡æ³•è‡ªå‹•ç™»å…¥ï¼Ÿ

**æª¢æŸ¥æ¸…å–®**ï¼š
1. ENV ä¸­çš„ `DEV_AUTO_LOGIN_EMAIL` æ˜¯å¦æ­£ç¢º
2. è³‡æ–™åº«ä¸­æ˜¯å¦å­˜åœ¨å°æ‡‰çš„ç”¨æˆ¶
3. ç”¨æˆ¶ç‹€æ…‹æ˜¯å¦ç‚º `approved`

**é©—è­‰**ï¼š
```bash
# æª¢æŸ¥ç’°å¢ƒè®Šæ•¸
podman exec memoryark2_backend_1 env | grep DEV_

# æª¢æŸ¥è³‡æ–™åº«
sqlite3 data/memoryark.db "SELECT * FROM users WHERE role='admin';"
```

### Q3: å®¹å™¨é‡å»ºå¾Œé‚„æ˜¯èˆŠçš„ç®¡ç†å“¡ï¼Ÿ

**åŸå› **ï¼šæ˜ åƒå¿«å–æˆ–è³‡æ–™åº«æŒä¹…åŒ–

**è§£æ±º**ï¼š
```bash
# å®Œå…¨æ¸…ç†é‡å»º
podman-compose down
podman rmi localhost/memoryark2_backend:latest
rm -rf data/*
podman build --no-cache -t memoryark2_backend:latest .
podman-compose up -d
```

## ğŸ“Š é©—è­‰æ­¥é©Ÿ

### æª¢æŸ¥ç³»çµ±ç‹€æ…‹

```bash
# 1. æª¢æŸ¥å®¹å™¨ç‹€æ…‹
podman ps

# 2. æª¢æŸ¥å¥åº·ç‹€æ…‹
curl http://localhost:7001/api/health

# 3. æª¢æŸ¥ç’°å¢ƒè®Šæ•¸
podman exec memoryark2_backend_1 env | grep -E "(ROOT_ADMIN|DEV_)"

# 4. æª¢æŸ¥è³‡æ–™åº«ä¸­çš„ç®¡ç†å“¡
sqlite3 data/memoryark.db "SELECT id, email, name, role, status FROM users WHERE role='admin';"
```

### é æœŸçµæœ

**ç’°å¢ƒè®Šæ•¸**ï¼š
```
ROOT_ADMIN_EMAIL=94work.net@gmail.com
ROOT_ADMIN_NAME=åŠ‰ç¨‹ç¶­
DEV_AUTO_LOGIN_EMAIL=94work.net@gmail.com
```

**è³‡æ–™åº«è¨˜éŒ„**ï¼š
```
1|94work.net@gmail.com|åŠ‰ç¨‹ç¶­|admin|approved
```

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é …

1. **ç”Ÿç”¢ç’°å¢ƒ**ï¼šé—œé–‰é–‹ç™¼æ¨¡å¼
```bash
DEVELOPMENT_MODE=false
DEV_BYPASS_AUTH=false
```

2. **å¼·å¯†ç¢¼**ï¼šç¢ºä¿ JWT å¯†é‘°è¶³å¤ å®‰å…¨
```bash
JWT_SECRET=your-super-secure-random-string
```

3. **å®šæœŸå‚™ä»½**ï¼šç®¡ç†å“¡è®Šæ›´å‰å…ˆå‚™ä»½è³‡æ–™åº«
```bash
cp -r data/ backup/data-$(date +%Y%m%d_%H%M%S)/
```

## ğŸ“ æœ€ä½³å¯¦è¸

1. **æ–‡æª”è¨˜éŒ„**ï¼šæ¯æ¬¡ç®¡ç†å“¡è®Šæ›´éƒ½è¦è¨˜éŒ„åŸå› å’Œæ™‚é–“
2. **æ¸¬è©¦é©—è­‰**ï¼šæ›´æ›å¾Œå‹™å¿…æ¸¬è©¦ç™»å…¥å’Œç®¡ç†åŠŸèƒ½
3. **å‚™ä»½ç­–ç•¥**ï¼šè®Šæ›´å‰å»ºç«‹å®Œæ•´å‚™ä»½
4. **ç‰ˆæœ¬æ§åˆ¶**ï¼š`.env` æª”æ¡ˆè®Šæ›´è¦æäº¤åˆ° Gitï¼ˆæ³¨æ„æ•æ„Ÿè³‡è¨Šï¼‰

---

**ç‰ˆæœ¬**ï¼šMemoryArk 2.0.2  
**æ›´æ–°æ—¥æœŸ**ï¼š2025-06-10  
**ç¶­è­·è€…**ï¼šåŠ‰ç¨‹ç¶­ <94work.net@gmail.com>