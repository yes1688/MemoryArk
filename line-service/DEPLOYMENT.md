# LINE Service å®¹å™¨åŒ–éƒ¨ç½²æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æª”èªªæ˜å¦‚ä½•éƒ¨ç½² LINE Service åˆ° MemoryArk2 ç³»çµ±ä¸­ï¼ŒåŒ…å«å®Œæ•´çš„å®¹å™¨åŒ–é…ç½®å’Œå®‰å…¨è¨­å®šã€‚

## ğŸ—ï¸ æ¶æ§‹æ¦‚è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MemoryArk2 + LINE æ•´åˆæ¶æ§‹                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¤–éƒ¨å­˜å–                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ Port 7001       â”‚    â”‚ Port 7002       â”‚                â”‚
â”‚  â”‚ MemoryArk å‰ç«¯   â”‚    â”‚ LINE Webhook    â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚           â”‚                       â”‚                         â”‚
â”‚           â–¼                       â–¼                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ nginx           â”‚    â”‚ line-nginx      â”‚                â”‚
â”‚  â”‚ (ä¸»æœå‹™)         â”‚    â”‚ (LINE å°ˆç”¨)      â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚           â”‚                       â”‚                         â”‚
â”‚           â–¼                       â–¼                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ backend         â”‚    â”‚ line-service    â”‚                â”‚
â”‚  â”‚ (Go + SQLite)   â”‚    â”‚ (Node.js + TS)  â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚           â”‚                       â”‚                         â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                       â–¼                                     â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚           â”‚ å…±äº«å„²å­˜         â”‚    â”‚ Redis éšŠåˆ—       â”‚        â”‚
â”‚           â”‚ - SQLite DB     â”‚    â”‚ (ä»»å‹™è™•ç†)       â”‚        â”‚
â”‚           â”‚ - æª”æ¡ˆä¸Šå‚³       â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. å‰ç½®éœ€æ±‚

- Docker æˆ– Podman å·²å®‰è£
- Docker Compose æˆ– Podman Compose
- LINE Developer å¸³è™Ÿå’Œ Bot æ†‘è­‰
- ç¶²åŸŸå’Œ SSL æ†‘è­‰ (ç”Ÿç”¢ç’°å¢ƒ)

### 2. ç’°å¢ƒé…ç½®

```bash
# è¤‡è£½ç’°å¢ƒè®Šæ•¸ç¯„æœ¬
cp .env.example .env

# ç·¨è¼¯ç’°å¢ƒè®Šæ•¸
nano .env
```

**å¿…é ˆè¨­å®šçš„è®Šæ•¸**ï¼š
```bash
# LINE Bot æ†‘è­‰
LINE_CHANNEL_ACCESS_TOKEN=your-actual-token
LINE_CHANNEL_SECRET=your-actual-secret

# ç®¡ç†å“¡è¨­å®š
ROOT_ADMIN_EMAIL=your-admin@email.com

# å®‰å…¨é‡‘é‘° (ç”Ÿç”¢ç’°å¢ƒè«‹æ›´æ”¹)
JWT_SECRET=your-secure-jwt-secret
MEMORYARK_API_KEY=your-internal-api-key
```

### 3. å»ºæ§‹å’Œéƒ¨ç½²

```bash
# å»ºæ§‹ MemoryArk å‰ç«¯ (å¦‚æœæœ‰è®Šæ›´)
docker-compose --profile build up frontend-builder

# å»ºæ§‹ä¸¦å•Ÿå‹•æ‰€æœ‰æœå‹™
docker-compose up -d

# æª¢æŸ¥æœå‹™ç‹€æ…‹
docker-compose ps

# æŸ¥çœ‹ LINE Service æ—¥èªŒ
docker-compose logs -f line-service
```

### 4. é©—è­‰éƒ¨ç½²

```bash
# æª¢æŸ¥å¥åº·ç‹€æ…‹
curl http://localhost:7001/api/health  # MemoryArk ä¸»æœå‹™
curl http://localhost:7002/health      # LINE Service

# åŸ·è¡Œå®‰å…¨æª¢æŸ¥
./line-service/scripts/security-check.sh
```

## ğŸ”§ æœå‹™é…ç½®è©³ç´°èªªæ˜

### LINE Service

- **æ˜ åƒæª”**: `memoryark-line-service:latest`
- **å…§éƒ¨ç«¯å£**: 3000
- **å¤–éƒ¨å­˜å–**: é€šé port 7002 (line-nginx)
- **å¥åº·æª¢æŸ¥**: `/health` ç«¯é»
- **æ—¥èªŒ**: `./line-service/logs/`

### LINE Nginx

- **æ˜ åƒæª”**: `nginx:alpine`
- **ç«¯å£**: 7002
- **é…ç½®æª”**: `./line-nginx.conf`
- **æ—¥èªŒ**: `./logs/nginx/`

### Redis

- **æ˜ åƒæª”**: `redis:7-alpine`
- **ç«¯å£**: 6379
- **æŒä¹…åŒ–**: AOF (appendonly)
- **è³‡æ–™**: `redis-data` volume

## ğŸ”’ å®‰å…¨é…ç½®

### ç¶²è·¯éš”é›¢

- æ‰€æœ‰æœå‹™é‹è¡Œåœ¨å°ˆç”¨çš„ `memoryark` ç¶²è·¯ä¸­
- LINE Service åªèƒ½è¢« line-nginx å­˜å–
- å¤–éƒ¨ç„¡æ³•ç›´æ¥å­˜å–å…§éƒ¨æœå‹™

### å®¹å™¨å®‰å…¨

- LINE Service ä»¥é root ç”¨æˆ¶ (`lineservice`) é‹è¡Œ
- æª”æ¡ˆç³»çµ±æ¬Šé™åš´æ ¼æ§åˆ¶
- æ•æ„Ÿè³‡æ–™é€éç’°å¢ƒè®Šæ•¸ç®¡ç†

### SSL/TLS

ç”Ÿç”¢ç’°å¢ƒå»ºè­°é…ç½® SSLï¼š

```bash
# åœ¨ line-nginx.conf ä¸­åŠ å…¥ SSL é…ç½®
server {
    listen 443 ssl http2;
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;
    # ... å…¶ä»–é…ç½®
}
```

## ğŸ“Š ç›£æ§å’Œç¶­è­·

### å¥åº·æª¢æŸ¥

æ‰€æœ‰æœå‹™éƒ½é…ç½®äº†å¥åº·æª¢æŸ¥ï¼š

```bash
# æª¢æŸ¥æ‰€æœ‰æœå‹™å¥åº·ç‹€æ…‹
docker-compose ps

# æª¢æŸ¥ç‰¹å®šæœå‹™
docker inspect --format='{{.State.Health.Status}}' memoryark-line-service
```

### æ—¥èªŒç®¡ç†

```bash
# æŸ¥çœ‹ LINE Service æ—¥èªŒ
docker-compose logs line-service

# æŸ¥çœ‹ Nginx æ—¥èªŒ
docker-compose logs line-nginx

# å¯¦æ™‚ç›£æ§
docker-compose logs -f --tail=100 line-service
```

### è³‡æ–™å‚™ä»½

```bash
# åœæ­¢æœå‹™
docker-compose stop

# å‚™ä»½é‡è¦è³‡æ–™
tar -czf backup-$(date +%Y%m%d).tar.gz data/ uploads/ logs/

# é‡æ–°å•Ÿå‹•
docker-compose up -d
```

## ğŸ”„ æ›´æ–°å’Œå‡ç´š

### æ›´æ–° LINE Service

```bash
# æ‹‰å–æœ€æ–°ç¨‹å¼ç¢¼
git pull

# é‡æ–°å»ºæ§‹ LINE Service
docker-compose build line-service

# é‡æ–°å•Ÿå‹•æœå‹™
docker-compose up -d line-service
```

### å‡ç´šæ•´å€‹ç³»çµ±

```bash
# åœæ­¢æ‰€æœ‰æœå‹™
docker-compose down

# å‚™ä»½è³‡æ–™
./scripts/backup.sh

# æ‹‰å–æ›´æ–°
git pull

# é‡æ–°å»ºæ§‹å’Œå•Ÿå‹•
docker-compose up -d --build
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

1. **LINE Service ç„¡æ³•å•Ÿå‹•**
   ```bash
   # æª¢æŸ¥ç’°å¢ƒè®Šæ•¸
   docker-compose config
   
   # æª¢æŸ¥å»ºæ§‹æ—¥èªŒ
   docker-compose build line-service
   ```

2. **ç„¡æ³•é€£æ¥åˆ° Redis**
   ```bash
   # æª¢æŸ¥ Redis ç‹€æ…‹
   docker-compose logs redis
   
   # æ¸¬è©¦é€£æ¥
   docker exec memoryark-redis redis-cli ping
   ```

3. **Webhook æ¥æ”¶å¤±æ•—**
   ```bash
   # æª¢æŸ¥ Nginx é…ç½®
   docker exec memoryark-line-nginx nginx -t
   
   # æª¢æŸ¥ LINE è¨­å®š
   curl -X POST http://localhost:7002/webhook/line \
     -H "Content-Type: application/json" \
     -d '{"test": true}'
   ```

### é™¤éŒ¯æ¨¡å¼

```bash
# å•Ÿç”¨é™¤éŒ¯æ—¥èªŒ
export LINE_LOG_LEVEL=debug
docker-compose up -d line-service

# é€²å…¥å®¹å™¨é™¤éŒ¯
docker exec -it memoryark-line-service sh
```

## ğŸ“ æ”¯æ´å’Œè¯ç¹«

- **GitHub Issues**: å›å ±å•é¡Œå’ŒåŠŸèƒ½è«‹æ±‚
- **æ–‡æª”**: æŸ¥çœ‹ `line_docs/` ç›®éŒ„
- **æ—¥èªŒåˆ†æ**: ä½¿ç”¨ `scripts/analyze-logs.sh`

---

**æœ€å¾Œæ›´æ–°**: 2024-06-24  
**ç‰ˆæœ¬**: 1.0  
**é©ç”¨ç³»çµ±**: MemoryArk2 + LINE Service