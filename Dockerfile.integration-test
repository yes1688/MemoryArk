# 整合測試容器 - 使用 Python 進行 API 測試
FROM python:3.11-alpine

# 安裝必要工具
RUN apk add --no-cache \
    curl \
    bash \
    gcc \
    musl-dev \
    libffi-dev \
    openssl-dev

# 安裝 Python 測試套件
RUN pip install --no-cache-dir \
    requests \
    pytest \
    pytest-html \
    pytest-json-report \
    pytest-timeout \
    pytest-xdist \
    colorama \
    tabulate \
    jinja2

# 設定工作目錄
WORKDIR /app

# 複製測試檔案
COPY testing/ /app/testing/

# 建立測試結果目錄
RUN mkdir -p /app/test-results

# 設定為可執行
RUN chmod +x /app/testing/*.py 2>/dev/null || true

# 預設執行測試
CMD ["python3", "/app/testing/run-integration-tests.py"]